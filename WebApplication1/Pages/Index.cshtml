@page
@model WebApplication1.Pages.IndexModel
@using WebApplication1.Models;
@using System.Linq;
@{
    ViewData["Title"] = "My Kanban Board";
}

<div class="container">
    <div class="row">
        <!-- To Do Column -->
        <div class="col-md-4 board-column">
            <h3>To Do</h3>
            <div class="tasks-list" data-status="todo">
                @foreach (var task in Model.Tasks.Where(t => t.Status == "todo").OrderBy(t => t.Position))
                {
                    <div class="task-card" data-task-id="@task.Id">
                        <h5>@task.Title</h5>
                        <p>@task.Description</p>
                        <div class="task-actions">
                            <form method="post" asp-page-handler="MoveTask">
                                <input type="hidden" name="taskId" value="@task.Id" />
                                <input type="hidden" name="newStatus" value="inprogress" />
                                <button type="submit" class="btn btn-sm btn-primary">→ In Progress</button>
                            </form>
                        </div>
                    </div>
                }
            </div>
            <form method="post" asp-page-handler="AddTask" class="mt-2">
                <input type="hidden" name="status" value="todo" />
                <input type="text" name="title" placeholder="Название задачи" required class="form-control" />
                <button type="submit" class="btn btn-success btn-sm mt-2">+ Добавить</button>
            </form>
        </div>

        <!-- In Progress Column -->
        <div class="col-md-4 board-column">
            <h3>In Progress</h3>
            <div class="tasks-list" data-status="inprogress">
                @foreach (var task in Model.Tasks.Where(t => t.Status == "inprogress").OrderBy(t => t.Position))
                {
                    <div class="task-card" data-task-id="@task.Id">
                        <h5>@task.Title</h5>
                        <p>@task.Description</p>
                        <div class="task-actions">
                            <form method="post" asp-page-handler="MoveTask">
                                <input type="hidden" name="taskId" value="@task.Id" />
                                <input type="hidden" name="newStatus" value="done" />
                                <button type="submit" class="btn btn-sm btn-primary">→ Done</button>
                            </form>
                            <form method="post" asp-page-handler="MoveTask" class="mt-1">
                                <input type="hidden" name="taskId" value="@task.Id" />
                                <input type="hidden" name="newStatus" value="todo" />
                                <button type="submit" class="btn btn-sm btn-secondary">← Back</button>
                            </form>
                        </div>
                    </div>
                }
            </div>
            <form method="post" asp-page-handler="AddTask" class="mt-2">
                <input type="hidden" name="status" value="inprogress" />
                <input type="text" name="title" placeholder="Название задачи" required class="form-control" />
                <button type="submit" class="btn btn-success btn-sm mt-2">+ Добавить</button>
            </form>
        </div>

        <!-- Done Column -->
        <div class="col-md-4 board-column">
            <h3>Done</h3>
            <div class="tasks-list" data-status="done">
                @foreach (var task in Model.Tasks.Where(t => t.Status == "done").OrderBy(t => t.Position))
                {
                    <div class="task-card" data-task-id="@task.Id">
                        <h5>@task.Title</h5>
                        <p>@task.Description</p>
                        <div class="task-actions">
                            <form method="post" asp-page-handler="MoveTask">
                                <input type="hidden" name="taskId" value="@task.Id" />
                                <input type="hidden" name="newStatus" value="inprogress" />
                                <button type="submit" class="btn btn-sm btn-secondary">← Back</button>
                            </form>
                        </div>
                    </div>
                }
            </div>
            <form method="post" asp-page-handler="AddTask" class="mt-2">
                <input type="hidden" name="status" value="done" />
                <input type="text" name="title" placeholder="Название задачи" required class="form-control" />
                <button type="submit" class="btn btn-success btn-sm mt-2">+ Добавить</button>
            </form>
        </div>
    </div>
</div>

<style>
    .board-column {
        background-color: #f0f0f0;
        padding: 15px;
        border-radius: 5px;
        margin: 10px;
        min-height: 600px;
    }
    
    .task-card {
        background: white;
        padding: 10px;
        margin: 10px 0;
        border-radius: 3px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }

    .board-column[data-status="todo"] {
        border-top: 5px solid #ff6b6b;
    }

    .board-column[data-status="inprogress"] {
        border-top: 5px solid #4dabf7;
    }

    .board-column[data-status="done"] {
        border-top: 5px solid #51cf66;
    }
</style>